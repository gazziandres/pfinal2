<p id="notice"><%= notice %></p>

<h1>Orders</h1>

<table>
  <thead>
    <tr>
      <th>Checked out at</th>
      <th>Address</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody id="orders-xyz">
    <%= render @orders %>
  </tbody>
</table>

<br>

<%= link_to 'New Order', new_order_path %>

<div style='width: 800px'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>

<script>
  handler = Gmaps.build('Google');
  handler.buildMap({
    provider: {
      center: new google.maps.LatLng({lat: -33.401293, lng: -70.578351}),
      zoom: 13
    },
    internal: {
      id: 'map'
    }
  },
  function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    google.maps.event.addListener(handler.getMap(), "click", function(){
      console.log("hola");
    });
    google.maps.event.addListener(handler.getMap(), 'center_changed', function(){
      var latitude = handler.getMap().getCenter().lat();
      var longitude = handler.getMap().getCenter().lng();
      $.ajax({
        url: '/orders',
        type: 'GET',
        dataType: 'script',
        data: {latitude: latitude, longitude: longitude}
      })

    });
  }
);
</script>
